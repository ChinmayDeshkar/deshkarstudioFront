<div class="container mt-4">
  <div class="card shadow-lg p-4 border-0">

    <!-- ============ TOP LEFT SEARCH OPTIONS ============ -->
    <div class="d-flex align-items-center mb-3">
      <ul class="nav nav-pills" id="searchTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active fw-semibold"
            id="customer-tab"
            data-bs-toggle="tab"
            data-bs-target="#customer"
            type="button"
            role="tab"
          >
            <i class="bi bi-person-badge"></i> Customer ID
          </button>
        </li>

        <li class="nav-item" role="presentation">
          <button
            class="nav-link fw-semibold"
            id="purchase-tab"
            data-bs-toggle="tab"
            data-bs-target="#purchase"
            type="button"
            role="tab"
          >
            <i class="bi bi-receipt-cutoff"></i> Purchase ID
          </button>
        </li>
      </ul>
    </div>

    <div class="tab-content mt-3">

      <!-- ======================================================
          SEARCH BY CUSTOMER ID
      ======================================================= -->
      <div
        class="tab-pane fade show active"
        id="customer"
        role="tabpanel"
        aria-labelledby="customer-tab"
      >
        <form [formGroup]="customerForm" (ngSubmit)="searchByCustomerId()" class="mb-3">
          <div class="input-group">
            <span class="input-group-text bg-primary text-white">
              <i class="bi bi-search"></i>
            </span>
            <input
              type="text"
              class="form-control"
              formControlName="customerId"
              placeholder="Enter Customer ID..."
            />
            <button class="btn btn-primary" [disabled]="customerForm.invalid || loading">
              Search
            </button>
          </div>
        </form>

        <!-- Results -->
        <div *ngIf="customerResult.length" class="mt-4">
          <h5 class="fw-bold mb-3 text-primary">
            Results for Customer ID: {{ customerForm.value.customerId }}
          </h5>

          <div class="table-responsive shadow-sm">
            <table class="table table-striped table-hover align-middle">
              <thead class="table-primary">
                <tr>
                  <th>Purchase ID</th>
                  <th>Name</th>
                  <th>Price</th>
                  <th>Payment</th>
                  <th>Status</th>
                  <th>Order Status</th>
                  <th>Date</th>
                  <th>Updated By</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let p of customerResult" (click)="openPurchaseDetails(p.purchaseId)" class="table-row-click">
                  <td>{{ p.purchaseId }}</td>
                  <td>{{ p.customer?.customerName }}</td>
                  <td>₹{{ p.price }}</td>
                  <td>{{ p.paymentMethod }}</td>
                  <td>
                    <span class="badge" [ngClass]="p.paymentStatus === 'PAID' ? 'bg-success' : 'bg-warning'">
                      {{ p.paymentStatus }}
                    </span>
                  </td>
                  <td>
                    <span class="badge"
                      [class.bg-secondary]="p.orderStatus === 'PROCESSING'"
                      [class.bg-success]="p.orderStatus === 'DELIVERED'"
                      [class.bg-danger]="p.orderStatus === 'CANCELLED'"
                      [class.bg-info]="p.orderStatus === 'CREATED'"
                      [class.bg-warning]="p.orderStatus === 'ON-HOLD'"
                      [class.bg-primary]="p.orderStatus === 'READY'">
                      {{ p.orderStatus }}
                    </span>
                  </td>
                  <td>{{ p.createdDate | date:'medium' }}</td>
                  <td>{{ p.updatedBy }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div *ngIf="customerResult.length === 0 && !loading" class="alert alert-info mt-3">
          No purchases found.
        </div>
      </div>

      <!-- ======================================================
          SEARCH BY PURCHASE ID
      ======================================================= -->
      <div
        class="tab-pane fade"
        id="purchase"
        role="tabpanel"
        aria-labelledby="purchase-tab"
      >
        <form [formGroup]="purchaseForm" (ngSubmit)="searchByPurchaseId()" class="mb-3">
          <div class="input-group">
            <span class="input-group-text bg-success text-white">
              <i class="bi bi-qr-code-scan"></i>
            </span>
            <input
              type="text"
              class="form-control"
              formControlName="purchaseId"
              placeholder="Enter Purchase ID..."
            />
            <button class="btn btn-success" [disabled]="purchaseForm.invalid || loading">
              Search
            </button>
          </div>
        </form>

        <div *ngIf="purchaseResult" class="mt-4">
          <h5 class="fw-bold mb-3 text-success">Purchase Details</h5>

          <div class="table-responsive shadow-sm">
            <table class="table table-striped table-hover align-middle">
              <thead class="table-success">
                <tr>
                  <th>Purchase ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Price</th>
                  <th>Payment</th>
                  <th>Status</th>
                  <th>Order</th>
                  <th>Advance</th>
                  <th>Balance</th>
                  <th>Date</th>
                  <th>Updated By</th>
                </tr>
              </thead>

              <tbody>
                <tr class="table-row-click" (click)="openPurchaseDetails(purchaseResult.purchaseId)">
                  <td>{{ purchaseResult.purchaseId }}</td>
                  <td>{{ purchaseResult.customer?.customerName }}</td>
                  <td>{{ purchaseResult.customer?.email }}</td>
                  <td>{{ purchaseResult.customer?.phoneNumber }}</td>
                  <td>₹{{ purchaseResult.price }}</td>
                  <td>{{ purchaseResult.paymentMethod }}</td>
                  <td>
                    <span class="badge" [ngClass]="purchaseResult.paymentStatus === 'PAID' ? 'bg-success' : 'bg-warning'">
                      {{ purchaseResult.paymentStatus }}
                    </span>
                  </td>
                  <td>
                    <span class="badge"
                      [class.bg-success]="purchaseResult.orderStatus === 'COMPLETED'"
                      [class.bg-secondary]="purchaseResult.orderStatus === 'PROCESSING'"
                      [class.bg-success]="purchaseResult.orderStatus === 'DELIVERED'"
                      [class.bg-danger]="purchaseResult.orderStatus === 'CANCELLED'"
                      [class.bg-info]="purchaseResult.orderStatus === 'CREATED'"
                      [class.bg-warning]="purchaseResult.orderStatus === 'ON-HOLD'"
                      [class.bg-primary]="purchaseResult.orderStatus === 'READY'">
                      {{ purchaseResult.orderStatus }}
                    </span>
                  </td>
                  <td>{{ purchaseResult.advancePaid }}</td>
                  <td>{{ purchaseResult.balance }}</td>
                  <td>{{ purchaseResult.createdDate | date:'medium' }}</td>
                  <td>{{ purchaseResult.updatedBy }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div *ngIf="!purchaseResult && purchaseSearched" class="alert alert-danger mt-3">
          Purchase not found.
        </div>
      </div>
    </div>
  </div>
</div>
