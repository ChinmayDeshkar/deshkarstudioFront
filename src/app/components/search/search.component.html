<section>
  <div class="container-fluid py-5 task-page">
    <div class="card shadow-lg border-0 p-4 mx-auto" style="max-width: 1200px;">
      <h2 class="text-center text-gradient fw-bold mb-4">
        <i class="bi bi-search"></i> Search Purchases
      </h2>

      <!-- Search Input -->
      <div class="mb-4">
        <label class="form-label fw-semibold">Customer Phone Number</label>
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            placeholder="Enter phone number"
            [(ngModel)]="phone"
          />
          <button class="btn btn-primary" (click)="search()">
            <i class="bi bi-search"></i> Search
          </button>
        </div>
      </div>

      <!-- Loading -->
      <div *ngIf="loading" class="text-center py-5">
        <div class="spinner-border text-primary"></div>
        <p class="mt-3 fw-semibold text-secondary">Searching...</p>
      </div>

      <!-- Results Table -->
      <div *ngIf="!loading && purchases.length > 0" class="table-responsive fade-in">
        <table class="table table-hover align-middle text-center">
          <thead class="table-primary">
            <tr>
              <th>Purchase ID</th>
              <th>Customer</th>
              <th>Phone</th>
              <th *ngIf="isAdmin">Price (â‚¹)</th>
              <th *ngIf="isAdmin">Balance</th>
              <th>Payment Status</th>
              <th>Order Status</th>
              <th>Remarks</th>
              <th>Created Date</th>
            </tr>
          </thead>

          <tbody>
            <tr
              *ngFor="let p of purchases"
              class="table-row-clickable"
              (click)="openPurchaseDetails(p.purchaseId)"
            >
              <td>{{ p.purchaseId }}</td>
              <td>{{ p.customerName }}</td>
              <td>{{ p.phoneNumber }}</td>

              <!-- Price -->
              <td class="fw-semibold text-success" *ngIf="isAdmin">
                {{ p.price }}
              </td>

              <!-- Balance -->
              <td
                [ngClass]="p.balance > 0 ? 'text-danger fw-semibold' : 'text-muted'"
                *ngIf="isAdmin"
              >
                {{ p.balance }}
              </td>

              <!-- Payment Status Badge -->
              <td>
                <span
                  class="badge"
                  [class.bg-success]="p.paymentStatus === 'PAID'"
                  [class.bg-warning]="p.paymentStatus === 'PENDING'"
                >
                  {{ p.paymentStatus }}
                </span>
              </td>

              <!-- Order Status Badge -->
              <td>
                <span
                  class="badge"
                  [class.bg-secondary]="p.orderStatus === 'CREATED'"
                  [class.bg-warning]="p.orderStatus === 'PROCESSING'"
                  [class.bg-danger]="p.orderStatus === 'CANCELLED'"
                  [class.bg-dark]="p.orderStatus === 'ON-HOLD'"
                  [class.bg-success]="p.orderStatus === 'READY' || p.orderStatus === 'DELIVERED'"
                >
                  {{ p.orderStatus }}
                </span>
              </td>

              <!-- Remarks -->
              <td [title]="p.remark" class="text-truncate remark-cell">
                {{
                  p.remark?.length > 20
                    ? (p.remark | slice : 0 : 20) + "..."
                    : (p.remark || "-")
                }}
              </td>

              <!-- Date -->
              <td>{{ p.dte_created | date : "medium" }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- No Data -->
      <div *ngIf="!loading && purchases.length === 0" class="text-center py-5">
        <i class="bi bi-emoji-frown fs-1 text-muted"></i>
        <p class="mt-2 text-muted fs-5">No purchases found.</p>
      </div>
    </div>
  </div>
</section>
